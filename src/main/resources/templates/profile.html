<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartTracking - Profilo Utente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/smarttracking-design-system.css}">
    <style>
        body {
            background: var(--gray-50);
        }

        .profile-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-lg);
            font-size: 3rem;
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .profile-role {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: rgba(255,255,255,0.2);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .info-item {
            background: white;
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            transition: all var(--transition-normal);
        }

        .info-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .info-icon {
            width: 50px;
            height: 50px;
            background: var(--info-light);
            color: var(--info);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .info-content {
            flex: 1;
        }

        .info-label {
            font-size: 0.75rem;
            color: var(--gray-500);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--spacing-xs);
        }

        .info-value {
            font-size: 1rem;
            color: var(--gray-900);
            font-weight: 600;
        }

        .form-section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .form-section-title i {
            color: var(--primary);
        }

        .form-grid-profile {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
        }

        .form-grid-profile .form-group-full {
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .form-grid-profile {
                grid-template-columns: 1fr;
            }

            .profile-name {
                font-size: 1.5rem;
            }

            .profile-avatar {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="navbar-brand">
            <i class="fas fa-map-marked-alt"></i>
            SmartTracking
        </div>
        <div class="nav-links">
            <a th:href="@{/dashboard}"><i class="fas fa-home"></i> Dashboard</a>
            
            <!-- Link Monitoraggio visibile a tutti -->
            <a th:href="@{/web/utenti-e-dispositivi}" style="color:var(--gray-700);">
                <i class="fas fa-network-wired"></i> Utenti & Dispositivi
            </a>

            <!-- Link Gestione Utenti (Solo Admin) -->
            <a th:if="${isAdmin}" th:href="@{/admin/users}" style="color:var(--gray-700);">
                <i class="fas fa-users-cog"></i> Gestione Utenti
            </a>

            <a th:href="@{/profile}" style="background:var(--primary); color:white;"><i class="fas fa-user"></i> Profilo</a>


            <!-- LOGOUT FORM (FIX SPRING SECURITY) -->
            <form th:action="@{/logout}" method="post" style="margin: 0;">
                <button type="submit" class="btn-logout" style="border:none; cursor:pointer;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </form>
        </div>
    </nav>

    <!-- CONTAINER -->
    <div class="container">
        <!-- PROFILE HEADER -->
        <div class="profile-header animate-fade-in">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="profile-name" th:text="${userProfile.firstname + ' ' + userProfile.lastname}">Nome Cognome</div>
            <div class="profile-role">
                <i class="fas fa-shield-alt"></i>
                <span th:text="${userProfile.role}">USER</span>
            </div>
        </div>

        <!-- SUCCESS MESSAGE -->
        <div th:if="${successMessage}" class="alert alert-success animate-slide-in">
            <i class="fas fa-check-circle"></i>
            <span th:text="${successMessage}"></span>
        </div>

        <!-- INFO GRID -->
        <div class="info-grid">
            <div class="info-item animate-fade-in">
                <div class="info-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Username</div>
                    <div class="info-value" th:text="${userProfile.username}">username</div>
                </div>
            </div>

            <div class="info-item animate-fade-in">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Email</div>
                    <div class="info-value" th:text="${userProfile.email}">email@example.com</div>
                </div>
            </div>
        </div>

        <!-- EDIT FORM CARD -->
        <div class="card animate-fade-in">
            <div class="form-section-title">
                <i class="fas fa-edit"></i>
                Modifica Profilo
            </div>

            <form th:action="@{/profile}" th:object="${userProfile}" method="post" id="profileForm">
                <input type="hidden" th:field="*{username}">
                <input type="hidden" th:field="*{email}">
                <input type="hidden" th:field="*{role}">
                <input type="hidden" th:field="*{gender}">

                <div class="form-grid-profile">
                    <!-- First Name -->
                    <div class="form-group">
                        <label class="form-label" for="firstname">
                            <i class="fas fa-user"></i> Nome <span style="color: var(--danger);">*</span>
                        </label>
                        <input
                            type="text"
                            id="firstname"
                            th:field="*{firstname}"
                            class="form-input"
                            placeholder="Mario"
                            required>
                        <div class="form-error" th:if="${#fields.hasErrors('firstname')}" th:errors="*{firstname}"></div>
                    </div>

                    <!-- Last Name -->
                    <div class="form-group">
                        <label class="form-label" for="lastname">
                            <i class="fas fa-user"></i> Cognome <span style="color: var(--danger);">*</span>
                        </label>
                        <input
                            type="text"
                            id="lastname"
                            th:field="*{lastname}"
                            class="form-input"
                            placeholder="Rossi"
                            required>
                        <div class="form-error" th:if="${#fields.hasErrors('lastname')}" th:errors="*{lastname}"></div>
                    </div>

                    <!-- City -->
                    <div class="form-group">
                        <label class="form-label" for="city">
                            <i class="fas fa-city"></i> Citt√†
                        </label>
                        <input
                            type="text"
                            id="city"
                            th:field="*{city}"
                            class="form-input"
                            placeholder="Roma">
                    </div>

                    <!-- Phone -->
                    <div class="form-group">
                        <label class="form-label" for="telephoneNumber">
                            <i class="fas fa-phone"></i> Telefono
                        </label>
                        <input
                            type="tel"
                            id="telephoneNumber"
                            th:field="*{telephoneNumber}"
                            class="form-input"
                            placeholder="+39 123 456 7890">
                        <div class="form-error" th:if="${#fields.hasErrors('telephoneNumber')}" th:errors="*{telephoneNumber}"></div>
                    </div>

                    <!-- Address -->
                    <div class="form-group form-group-full">
                        <label class="form-label" for="address">
                            <i class="fas fa-map-marker-alt"></i> Indirizzo
                        </label>
                        <input
                            type="text"
                            id="address"
                            th:field="*{address}"
                            class="form-input"
                            placeholder="Via Roma, 123">
                    </div>

                    <!-- Tax ID -->
                    <div class="form-group form-group-full">
                        <label class="form-label" for="taxIdentificationNumber">
                            <i class="fas fa-id-card"></i> Codice Fiscale
                        </label>
                        <input
                            type="text"
                            id="taxIdentificationNumber"
                            th:field="*{taxIdentificationNumber}"
                            class="form-input"
                            placeholder="RSSMRA80A01H501U"
                            maxlength="16">
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-full btn-large mt-4">
                    <i class="fas fa-save"></i>
                    Aggiorna Profilo
                </button>
            </form>
        </div>
    </div>

    <script>
        // Form submission animation
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            const btn = this.querySelector('button[type="submit"]');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvataggio...';
            btn.disabled = true;
        });

        // Auto-hide success message after 5 seconds
        const successAlert = document.querySelector('.alert-success');
        if (successAlert) {
            setTimeout(() => {
                successAlert.style.opacity = '0';
                successAlert.style.transform = 'translateX(20px)';
                setTimeout(() => successAlert.remove(), 300);
            }, 5000);
        }
    </script>

    <!-- Anime.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <!-- SmartTracking Custom Animations -->
    <script th:src="@{/js/smarttracking-animations.js}"></script>
</body>
</html>
